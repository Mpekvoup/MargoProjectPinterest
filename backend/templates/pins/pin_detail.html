{% extends 'base.html' %}

{% block title %}{{ pin.title }} - Pinterest Clone{% endblock %}

{% block content %}
<div class="container">
    <div class="pin-detail">
        <div class="pin-detail-image">
            <img src="{{ pin.image.url }}" alt="{{ pin.title }}">
        </div>

        <div class="pin-detail-content">
            <div class="pin-detail-header">
                <div class="pin-actions">
                    {% if user.is_authenticated %}
                        <button class="btn-icon like-btn {% if pin.is_liked_by user %}liked{% endif %}"
                                data-pin-id="{{ pin.id }}"
                                onclick="toggleLike({{ pin.id }})">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                            </svg>
                            <span class="like-count">{{ pin.like_count }}</span>
                        </button>
                    {% endif %}

                    {% if user == pin.user %}
                        <a href="{% url 'pin_edit' pin.pk %}" class="btn btn-secondary">Редактировать</a>
                        <a href="{% url 'pin_delete' pin.pk %}" class="btn btn-danger">Удалить</a>
                    {% endif %}
                </div>
            </div>

            <h1 class="pin-detail-title">{{ pin.title }}</h1>

            {% if pin.description %}
                <p class="pin-detail-description">{{ pin.description }}</p>
            {% endif %}

            {% if pin.source_url %}
                <div class="pin-source">
                    <strong>Источник:</strong>
                    <a href="{{ pin.source_url }}" target="_blank" rel="noopener">{{ pin.source_url }}</a>
                </div>
            {% endif %}

            {% if pin.tags %}
                <div class="pin-tags">
                    {% for tag in pin.get_tags_list %}
                        <a href="{% url 'home' %}?query={{ tag }}" class="tag">#{{ tag }}</a>
                    {% endfor %}
                </div>
            {% endif %}

            <div class="pin-author-info">
                <a href="{% url 'profile' pin.user.username %}" class="author-link">
                    <div class="author-avatar">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                    </div>
                    <div class="author-info">
                        <strong>{{ pin.user.username }}</strong>
                        <small>{{ pin.user.pins.count }} пинов</small>
                    </div>
                </a>
            </div>

            {% if pin.board %}
                <div class="pin-board">
                    <strong>Доска:</strong>
                    <a href="{% url 'board_detail' pin.board.slug %}">{{ pin.board.name }}</a>
                </div>
            {% endif %}

            <div class="pin-meta-info">
                <small>Создан: {{ pin.created_at|date:"d.m.Y H:i" }}</small>
            </div>

            <!-- Comments Section -->
            <div class="comments-section">
                <h3>Комментарии ({{ comments.count }})</h3>

                {% if user.is_authenticated %}
                    <form method="post" class="comment-form">
                        {% csrf_token %}
                        {{ comment_form.as_p }}
                        <button type="submit" class="btn btn-primary">Отправить</button>
                    </form>
                {% else %}
                    <p><a href="{% url 'login' %}">Войдите</a>, чтобы оставить комментарий</p>
                {% endif %}

                <div class="comments-list">
                    {% for comment in comments %}
                        <div class="comment">
                            <div class="comment-author">
                                <strong>{{ comment.user.username }}</strong>
                                <small>{{ comment.created_at|date:"d.m.Y H:i" }}</small>
                            </div>
                            <p>{{ comment.text }}</p>
                        </div>
                    {% empty %}
                        <p class="no-comments">Комментариев пока нет</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
